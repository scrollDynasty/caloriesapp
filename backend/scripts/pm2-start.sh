#!/bin/bash

# =============================================================================
# –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ backend —á–µ—Ä–µ–∑ PM2
# =============================================================================

cd "$(dirname "$0")/.."

echo "üöÄ –ó–∞–ø—É—Å–∫ CaloriesApp Backend —á–µ—Ä–µ–∑ PM2"
echo "========================================="

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ PM2
if ! command -v pm2 &> /dev/null; then
    echo "‚ùå PM2 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    echo "   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: npm install -g pm2"
    exit 1
fi

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ .env
if [ ! -f .env ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# 3. –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p logs

# 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2
echo ""
echo "1Ô∏è‚É£ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2..."
pm2 start ecosystem.config.js

# 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
pm2 save

echo ""
echo "‚úÖ Backend –∑–∞–ø—É—â–µ–Ω!"
echo ""
echo "üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "   pm2 status                    # –°—Ç–∞—Ç—É—Å"
echo "   pm2 logs caloriesapp-backend # –õ–æ–≥–∏"
echo "   pm2 monit                     # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
echo "   pm2 restart caloriesapp-backend # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫"
echo "   pm2 stop caloriesapp-backend  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞"

